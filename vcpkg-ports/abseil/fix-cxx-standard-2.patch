From de284bf5c86056a345fe60a94f1c85225b66824c Mon Sep 17 00:00:00 2001
From: zesun <sunze1@foxmail.com>
Date: Sun, 8 Jun 2025 00:30:36 +0800
Subject: [PATCH] absl baso options;

---
 CMake/abslConfig.cmake.in |  2 ++
 CMakeLists.txt            | 17 +++++++++++++++++
 absl/base/CMakeLists.txt  |  6 ++++++
 absl/base/options.h       | 14 ++++++--------
 4 files changed, 31 insertions(+), 8 deletions(-)

diff --git a/CMake/abslConfig.cmake.in b/CMake/abslConfig.cmake.in
index 62d246d0..00947cf1 100644
--- a/CMake/abslConfig.cmake.in
+++ b/CMake/abslConfig.cmake.in
@@ -6,3 +6,5 @@ find_dependency(Threads)
 @PACKAGE_INIT@
 
 include ("${CMAKE_CURRENT_LIST_DIR}/@PROJECT_NAME@Targets.cmake")
+
+set(ABSL_USE_CXX17 @ABSL_USE_CXX17@)
\ No newline at end of file
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7c82b3a7..38466518 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -41,6 +41,23 @@ else()
   option(ABSL_ENABLE_INSTALL "Enable install rule" ON)
 endif()
 
+# CXX standard
+option(ABSL_USE_CXX17 "Enable CXX 17 standard" OFF)
+
+if (ABSL_USE_CXX17)
+    set(CMAKE_CXX_STANDARD 17)
+    set(STD_ANY 1)
+    set(STD_OPTIONAL 1)
+    set(STD_STRING_VIEW 1)
+    set(STD_VARIANT 1)
+else()
+    set(CMAKE_CXX_STANDARD 11)
+    set(STD_ANY 0)
+    set(STD_OPTIONAL 0)
+    set(STD_STRING_VIEW 0)
+    set(STD_VARIANT 0)
+endif()
+
 set(CMAKE_INSTALL_RPATH "$ORIGIN")
 set(CMAKE_INSTALL_RPATH_USE_LINK_PATH ON)
 set(CMAKE_BUILD_RPATH_USE_ORIGIN ON)
diff --git a/absl/base/CMakeLists.txt b/absl/base/CMakeLists.txt
index 97994fc6..b983a9c7 100644
--- a/absl/base/CMakeLists.txt
+++ b/absl/base/CMakeLists.txt
@@ -41,6 +41,12 @@ absl_cc_library(
     ${ABSL_DEFAULT_COPTS}
 )
 
+if (NOT EXISTS ${CMAKE_CURRENT_LIST_DIR}/options.h.in)
+    file(RENAME ${CMAKE_CURRENT_LIST_DIR}/options.h ${CMAKE_CURRENT_LIST_DIR}/options.h.in)
+endif()
+file(REMOVE ${CMAKE_CURRENT_LIST_DIR}/options.h)
+configure_file(${CMAKE_CURRENT_LIST_DIR}/options.h.in ${CMAKE_CURRENT_LIST_DIR}/options.h @ONLY)
+
 absl_cc_library(
   NAME
     log_severity
diff --git a/absl/base/options.h b/absl/base/options.h
index 61a996b6..26822c46 100644
--- a/absl/base/options.h
+++ b/absl/base/options.h
@@ -94,8 +94,7 @@
 // User code should not inspect this macro.  To check in the preprocessor if
 // absl::any is a typedef of std::any, use the feature macro ABSL_USES_STD_ANY.
 
-#define ABSL_OPTION_USE_STD_ANY 2
-
+#define ABSL_OPTION_USE_STD_ANY @STD_ANY @
 
 // ABSL_OPTION_USE_STD_OPTIONAL
 //
@@ -121,8 +120,7 @@
 // absl::optional is a typedef of std::optional, use the feature macro
 // ABSL_USES_STD_OPTIONAL.
 
-#define ABSL_OPTION_USE_STD_OPTIONAL 2
-
+#define ABSL_OPTION_USE_STD_OPTIONAL @STD_OPTIONAL @
 
 // ABSL_OPTION_USE_STD_STRING_VIEW
 //
@@ -148,7 +146,7 @@
 // absl::string_view is a typedef of std::string_view, use the feature macro
 // ABSL_USES_STD_STRING_VIEW.
 
-#define ABSL_OPTION_USE_STD_STRING_VIEW 2
+#define ABSL_OPTION_USE_STD_STRING_VIEW @STD_STRING_VIEW @
 
 // ABSL_OPTION_USE_STD_VARIANT
 //
@@ -174,7 +172,7 @@
 // absl::variant is a typedef of std::variant, use the feature macro
 // ABSL_USES_STD_VARIANT.
 
-#define ABSL_OPTION_USE_STD_VARIANT 2
+#define ABSL_OPTION_USE_STD_VARIANT @STD_VARIANT @
 
 // ABSL_OPTION_USE_STD_ORDERING
 //
@@ -225,8 +223,8 @@
 // be changed to a new, unique identifier name.  In particular "head" is not
 // allowed.
 
-#define ABSL_OPTION_USE_INLINE_NAMESPACE 1
-#define ABSL_OPTION_INLINE_NAMESPACE_NAME lts_20240722
+#define ABSL_OPTION_USE_INLINE_NAMESPACE 0
+#define ABSL_OPTION_INLINE_NAMESPACE_NAME
 
 // ABSL_OPTION_HARDENED
 //
-- 
2.34.1.windows.1

